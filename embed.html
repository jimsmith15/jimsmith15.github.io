<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Embed Viewer</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 30px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    h1 {
      color: white;
      margin-bottom: 20px;
      font-size: 28px;
      text-align: center;
    }

    .input-section {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .url-input {
      flex: 1;
      min-width: 300px;
      padding: 15px 20px;
      border: none;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      font-size: 16px;
      outline: none;
    }

    .url-input::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }

    .button {
      padding: 15px 25px;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 10px;
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .button:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .embed-wrapper {
      width: 100%;
      height: 80vh;
      min-height: 600px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
      overflow: hidden;
      position: relative;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .method-selector {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .method-btn {
      padding: 10px 20px;
      background: rgba(255, 255, 255, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      color: white;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .method-btn.active {
      background: rgba(103, 126, 234, 0.8);
      border-color: rgba(103, 126, 234, 1);
    }

    .method-btn:hover {
      background: rgba(255, 255, 255, 0.25);
    }

    .back-button {
      display: inline-block;
      margin-top: 20px;
      padding: 12px 24px;
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 10px;
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      transition: transform 0.2s ease, background 0.2s ease;
    }

    .back-button:hover {
      transform: translateY(-2px);
      background: rgba(255, 255, 255, 0.3);
    }

    .error-message {
      color: #ff6b6b;
      background: rgba(255, 107, 107, 0.2);
      padding: 15px;
      border-radius: 10px;
      margin-top: 15px;
      text-align: center;
    }

    .info-text {
      color: rgba(255, 255, 255, 0.8);
      font-size: 14px;
      margin-top: 10px;
      text-align: center;
    }

    @media (max-width: 768px) {
      .input-section {
        flex-direction: column;
      }

      .url-input {
        min-width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîì Embed Viewer</h1>
    
    <div class="input-section">
      <input 
        type="text" 
        id="urlInput" 
        class="url-input" 
        placeholder="Enter URL to embed (e.g., https://example.com)"
        autocomplete="off"
      />
      <button class="button" onclick="loadEmbed()">Load</button>
      <button class="button" onclick="openInNewTab()">Open in New Tab</button>
    </div>

    <div class="method-selector">
      <button class="method-btn active" onclick="setMethod('iframe')" id="btn-iframe">Direct Iframe</button>
      <button class="method-btn" onclick="setMethod('static')" id="btn-static">Static Iframe</button>
      <button class="method-btn" onclick="setMethod('redirect')" id="btn-redirect">Redirect Service</button>
      <button class="method-btn" onclick="setMethod('proxy')" id="btn-proxy">Proxy Method</button>
      <button class="method-btn" onclick="setMethod('blob')" id="btn-blob">Blob URL</button>
      <button class="method-btn" onclick="setMethod('inject')" id="btn-inject">Direct Inject</button>
    </div>

    <div id="errorMessage" class="error-message" style="display: none;"></div>
    
    <div class="embed-wrapper" id="embedWrapper">
      <iframe id="embedFrame" style="display: none;"></iframe>
      <iframe id="staticFrame" style="display: none; width: 100%; height: 100%; border: none;"></iframe>
      <object id="embedObject" style="display: none; width: 100%; height: 100%;"></object>
      <embed id="embedEmbed" style="display: none; width: 100%; height: 100%;"></embed>
      <div id="proxyContent" style="display: none; width: 100%; height: 100%; overflow: auto; padding: 20px; color: white;">
        <p>Loading via proxy method...</p>
      </div>
      <div id="injectContent" style="display: none; width: 100%; height: 100%; overflow: auto; background: white; border-radius: 10px;"></div>
      <div id="redirectContent" style="display: none; width: 100%; height: 100%; text-align: center; padding: 40px; color: white;">
        <p>Preparing redirect...</p>
      </div>
    </div>

    <p class="info-text">
      üí° Tip: If one method doesn't work, try switching to another method above
    </p>

    <a href="index.html" class="back-button">‚Üê Back to Home</a>
  </div>

  <script>
    let currentMethod = 'iframe';
    let currentUrl = '';

    // Load URL from query parameter if present
    const urlParams = new URLSearchParams(window.location.search);
    const urlParam = urlParams.get('url');
    if (urlParam) {
      document.getElementById('urlInput').value = decodeURIComponent(urlParam);
      loadEmbed();
    }

    function setMethod(method) {
      currentMethod = method;
      
      // Update button states
      document.querySelectorAll('.method-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.getElementById(`btn-${method}`).classList.add('active');
      
      // Reload with new method if URL is already set
      if (currentUrl) {
        loadEmbed();
      }
    }

    function loadEmbed() {
      const url = document.getElementById('urlInput').value.trim();
      if (!url) {
        showError('Please enter a URL');
        return;
      }

      // Validate URL
      let validUrl;
      try {
        validUrl = new URL(url);
      } catch (e) {
        // Try adding https:// if no protocol
        try {
          validUrl = new URL('https://' + url);
        } catch (e2) {
          showError('Invalid URL format');
          return;
        }
      }

      currentUrl = validUrl.href;
      hideError();

      // Hide all embed methods
      document.getElementById('embedFrame').style.display = 'none';
      document.getElementById('staticFrame').style.display = 'none';
      document.getElementById('embedObject').style.display = 'none';
      document.getElementById('embedEmbed').style.display = 'none';
      document.getElementById('proxyContent').style.display = 'none';
      document.getElementById('injectContent').style.display = 'none';
      document.getElementById('redirectContent').style.display = 'none';
      
      // Remove any existing dynamic iframes
      const existingDataIframe = document.getElementById('dataUrlFrame');
      if (existingDataIframe) existingDataIframe.remove();
      const existingBlobIframe = document.getElementById('blobUrlFrame');
      if (existingBlobIframe) existingBlobIframe.remove();

      // Load based on selected method
      switch(currentMethod) {
        case 'iframe':
          loadIframe(currentUrl);
          break;
        case 'static':
          loadStaticIframe(currentUrl);
          break;
        case 'redirect':
          loadRedirectService(currentUrl);
          break;
        case 'proxy':
          loadProxy(currentUrl);
          break;
        case 'blob':
          loadBlobUrl(currentUrl);
          break;
        case 'inject':
          loadDirectInject(currentUrl);
          break;
        case 'dataurl':
          loadDataUrl(currentUrl);
          break;
        case 'object':
          loadObject(currentUrl);
          break;
        case 'embed':
          loadEmbedTag(currentUrl);
          break;
      }
    }

    function loadIframe(url) {
      const frame = document.getElementById('embedFrame');
      frame.src = url;
      frame.style.display = 'block';
      
      frame.onerror = function() {
        showError('Failed to load via iframe. Try Static Iframe method.');
      };
    }

    function loadStaticIframe(url) {
      // Use a pre-existing static iframe (not created by JS)
      const frame = document.getElementById('staticFrame');
      
      // Try multiple URL encoding methods
      const encodedUrl = encodeURIComponent(url);
      const base64Url = btoa(url).replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
      
      // Try direct URL first
      frame.src = url;
      frame.style.display = 'block';
      
      // If that fails, try through a redirect service
      frame.onerror = function() {
        // Try using a redirect service
        frame.src = `https://redirect.is/?url=${encodedUrl}`;
      };
    }

    function loadRedirectService(url) {
      const redirectDiv = document.getElementById('redirectContent');
      redirectDiv.style.display = 'block';
      
      // Try multiple redirect/shortener services that might not be blocked
      const redirectServices = [
        `https://redirect.is/?url=${encodeURIComponent(url)}`,
        `https://tinyurl.com/api-create.php?url=${encodeURIComponent(url)}`,
        `https://is.gd/create.php?format=json&url=${encodeURIComponent(url)}`
      ];
      
      // Create iframe with redirect service
      const iframe = document.createElement('iframe');
      iframe.style.width = '100%';
      iframe.style.height = '100%';
      iframe.style.border = 'none';
      iframe.src = redirectServices[0];
      
      redirectDiv.innerHTML = '';
      redirectDiv.appendChild(iframe);
      
      iframe.onerror = function() {
        redirectDiv.innerHTML = `
          <div style="padding: 40px;">
            <h3 style="margin-bottom: 20px;">Redirect services blocked</h3>
            <p style="margin-bottom: 20px;">Try opening directly:</p>
            <a href="${url}" target="_blank" class="button" style="display: inline-block; margin: 10px;">Open in New Tab</a>
          </div>
        `;
      };
    }

    function loadObject(url) {
      const obj = document.getElementById('embedObject');
      obj.data = url;
      obj.type = 'text/html';
      obj.style.display = 'block';
    }

    function loadEmbedTag(url) {
      const embed = document.getElementById('embedEmbed');
      embed.src = url;
      embed.type = 'text/html';
      embed.style.display = 'block';
    }

    function loadBlobUrl(url) {
      const proxyDiv = document.getElementById('proxyContent');
      proxyDiv.style.display = 'block';
      proxyDiv.innerHTML = '<p style="text-align: center; padding: 20px;">Loading via proxy to create blob URL...</p>';

      // Try multiple proxy services
      const proxies = [
        `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`,
        `https://corsproxy.io/?${encodeURIComponent(url)}`,
        `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`
      ];

      let proxyIndex = 0;

      function tryNextProxy() {
        if (proxyIndex >= proxies.length) {
          proxyDiv.innerHTML = `
            <div style="text-align: center; padding: 40px; color: white;">
              <p>All proxies failed. Try Direct Inject method.</p>
              <button class="button" onclick="setMethod('inject'); loadEmbed();" style="margin: 10px;">Try Direct Inject</button>
            </div>
          `;
          return;
        }

        fetch(proxies[proxyIndex])
          .then(response => {
            if (!response.ok) throw new Error('Proxy failed');
            return response.text();
          })
          .then(data => {
            try {
              const parsed = JSON.parse(data);
              var html = parsed.contents || parsed.content || data;
            } catch (e) {
              var html = data;
            }
            
            const baseUrl = new URL(url);
            html = rewriteUrls(html, baseUrl);
            
            // Create blob URL
            const blob = new Blob([html], { type: 'text/html' });
            const blobUrl = URL.createObjectURL(blob);
            
            // Try multiple iframe creation methods
            try {
              // Method 1: Create iframe with blob URL
              const iframe = document.createElement('iframe');
              iframe.id = 'blobUrlFrame';
              iframe.style.width = '100%';
              iframe.style.height = '100%';
              iframe.style.border = 'none';
              iframe.src = blobUrl;
              
              proxyDiv.innerHTML = '';
              proxyDiv.appendChild(iframe);
            } catch (e) {
              // Method 2: Use srcdoc if available
              try {
                const iframe = document.createElement('iframe');
                iframe.id = 'blobUrlFrame';
                iframe.style.width = '100%';
                iframe.style.height = '100%';
                iframe.style.border = 'none';
                iframe.srcdoc = html;
                
                proxyDiv.innerHTML = '';
                proxyDiv.appendChild(iframe);
              } catch (e2) {
                // Fallback to direct inject
                setMethod('inject');
                loadDirectInject(url);
              }
            }
          })
          .catch(error => {
            proxyIndex++;
            tryNextProxy();
          });
      }

      tryNextProxy();
    }

    function loadDirectInject(url) {
      const injectDiv = document.getElementById('injectContent');
      injectDiv.style.display = 'block';
      injectDiv.innerHTML = '<p style="text-align: center; padding: 20px; color: #333;">Loading content...</p>';

      // Try multiple proxy services
      const proxies = [
        {
          url: `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`,
          parser: (data) => {
            try {
              const parsed = JSON.parse(data);
              return parsed.contents || parsed.content || data;
            } catch (e) {
              return data;
            }
          }
        },
        {
          url: `https://corsproxy.io/?${encodeURIComponent(url)}`,
          parser: (data) => data
        },
        {
          url: `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`,
          parser: (data) => data
        }
      ];

      let proxyIndex = 0;

      function tryNextProxy() {
        if (proxyIndex >= proxies.length) {
          injectDiv.innerHTML = `
            <div style="text-align: center; padding: 40px; color: #333;">
              <h3>All proxy methods failed</h3>
              <p>Try opening in a new tab or use a different method.</p>
              <button class="button" onclick="openInNewTab()" style="margin: 10px; background: #667eea; color: white;">Open in New Tab</button>
            </div>
          `;
          return;
        }

        const proxy = proxies[proxyIndex];
        
        fetch(proxy.url)
          .then(response => {
            if (!response.ok) throw new Error('Proxy failed');
            return response.text();
          })
          .then(data => {
            let html = proxy.parser(data);
            const baseUrl = new URL(url);
            html = rewriteUrls(html, baseUrl);
            
            // Directly inject HTML (no iframe)
            injectDiv.innerHTML = html;
          })
          .catch(error => {
            proxyIndex++;
            tryNextProxy();
          });
      }

      tryNextProxy();
    }

    function loadDataUrl(url) {
      const proxyDiv = document.getElementById('proxyContent');
      proxyDiv.style.display = 'block';
      proxyDiv.innerHTML = '<p style="text-align: center; padding: 20px;">Loading via proxy to create data URL...</p>';

      // Fetch via proxy and create data URL
      const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
      
      fetch(proxyUrl)
        .then(response => {
          if (!response.ok) throw new Error('Proxy failed');
          return response.text();
        })
        .then(data => {
          try {
            const parsed = JSON.parse(data);
            const html = parsed.contents || parsed.content || data;
            
            // Try using srcdoc first (works better on some filters)
            try {
              const iframe = document.createElement('iframe');
              iframe.id = 'dataUrlFrame';
              iframe.style.width = '100%';
              iframe.style.height = '100%';
              iframe.style.border = 'none';
              
              const baseUrl = new URL(url);
              const processedHtml = rewriteUrls(html, baseUrl);
              
              // Use srcdoc instead of data URL (might bypass some filters)
              iframe.srcdoc = processedHtml;
              
              proxyDiv.innerHTML = '';
              proxyDiv.appendChild(iframe);
            } catch (e) {
              // Fallback to data URL
              const iframe = document.createElement('iframe');
              iframe.id = 'dataUrlFrame';
              iframe.style.width = '100%';
              iframe.style.height = '100%';
              iframe.style.border = 'none';
              
              const baseUrl = new URL(url);
              const processedHtml = rewriteUrls(html, baseUrl);
              const dataUrl = 'data:text/html;charset=utf-8,' + encodeURIComponent(processedHtml);
              
              proxyDiv.innerHTML = '';
              proxyDiv.appendChild(iframe);
              iframe.src = dataUrl;
            }
          } catch (e) {
            proxyDiv.innerHTML = `
              <div style="text-align: center; padding: 40px; color: white;">
                <p>Failed to load. Try the Direct Inject method instead.</p>
                <button class="button" onclick="setMethod('inject'); loadEmbed();" style="margin: 10px;">Try Direct Inject</button>
              </div>
            `;
          }
        })
        .catch(error => {
          proxyDiv.innerHTML = `
            <div style="text-align: center; padding: 40px; color: white;">
              <p>Failed to fetch content. Try Direct Inject method.</p>
              <button class="button" onclick="setMethod('inject'); loadEmbed();" style="margin: 10px;">Try Direct Inject</button>
            </div>
          `;
        });
    }

    function loadProxy(url) {
      const proxyDiv = document.getElementById('proxyContent');
      proxyDiv.style.display = 'block';
      proxyDiv.innerHTML = '<p style="text-align: center; padding: 20px;">Loading via proxy...</p>';

      // Try multiple CORS proxy services
      const proxies = [
        {
          url: `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`,
          parser: (data) => {
            try {
              const parsed = JSON.parse(data);
              return parsed.contents || parsed.content || data;
            } catch (e) {
              return data;
            }
          }
        },
        {
          url: `https://corsproxy.io/?${encodeURIComponent(url)}`,
          parser: (data) => data
        },
        {
          url: `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`,
          parser: (data) => data
        }
      ];

      let proxyIndex = 0;

      function tryNextProxy() {
        if (proxyIndex >= proxies.length) {
          proxyDiv.innerHTML = `
            <div style="text-align: center; padding: 40px; color: white;">
              <h3 style="margin-bottom: 20px;">Proxy methods failed</h3>
              <p style="margin-bottom: 20px;">Try Direct Inject method - it might work better on filtered networks.</p>
              <button class="button" onclick="setMethod('inject'); loadEmbed();" style="margin: 10px;">Try Direct Inject</button>
              <button class="button" onclick="openInNewTab()" style="margin: 10px;">Open in New Tab</button>
            </div>
          `;
          return;
        }

        const proxy = proxies[proxyIndex];
        
        fetch(proxy.url)
          .then(response => {
            if (!response.ok) throw new Error('Proxy failed');
            return response.text();
          })
          .then(data => {
            let html = proxy.parser(data);
            
            // Rewrite relative URLs to absolute URLs
            const baseUrl = new URL(url);
            html = rewriteUrls(html, baseUrl);
            
            // Try multiple iframe creation methods
            try {
              // Method 1: Try srcdoc first (often works better with filters)
              const iframe = document.createElement('iframe');
              iframe.style.width = '100%';
              iframe.style.height = '100%';
              iframe.style.border = 'none';
              iframe.srcdoc = html;
              
              proxyDiv.innerHTML = '';
              proxyDiv.appendChild(iframe);
            } catch (e) {
              // Method 2: Try writing to iframe document
              try {
                const iframe = document.createElement('iframe');
                iframe.style.width = '100%';
                iframe.style.height = '100%';
                iframe.style.border = 'none';
                iframe.sandbox = 'allow-same-origin allow-scripts allow-forms allow-popups allow-modals';
                
                proxyDiv.innerHTML = '';
                proxyDiv.appendChild(iframe);
                
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                iframeDoc.open();
                iframeDoc.write(html);
                iframeDoc.close();
              } catch (e2) {
                // Method 3: Fallback to direct inject if iframes are blocked
                console.log('Iframe blocked, trying direct inject');
                setMethod('inject');
                loadDirectInject(url);
              }
            }
          })
          .catch(error => {
            proxyIndex++;
            tryNextProxy();
          });
      }

      tryNextProxy();
    }

    function rewriteUrls(html, baseUrl) {
      // Rewrite relative URLs to absolute URLs
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');
      
      // Fix all links
      doc.querySelectorAll('a[href]').forEach(link => {
        try {
          const href = link.getAttribute('href');
          if (href && !href.startsWith('http') && !href.startsWith('//') && !href.startsWith('#')) {
            link.href = new URL(href, baseUrl).href;
          }
        } catch (e) {}
      });
      
      // Fix all images
      doc.querySelectorAll('img[src]').forEach(img => {
        try {
          const src = img.getAttribute('src');
          if (src && !src.startsWith('http') && !src.startsWith('//') && !src.startsWith('data:')) {
            img.src = new URL(src, baseUrl).href;
          }
        } catch (e) {}
      });
      
      // Fix all scripts
      doc.querySelectorAll('script[src]').forEach(script => {
        try {
          const src = script.getAttribute('src');
          if (src && !src.startsWith('http') && !src.startsWith('//')) {
            script.src = new URL(src, baseUrl).href;
          }
        } catch (e) {}
      });
      
      // Fix all stylesheets
      doc.querySelectorAll('link[href]').forEach(link => {
        try {
          const href = link.getAttribute('href');
          if (href && !href.startsWith('http') && !href.startsWith('//')) {
            link.href = new URL(href, baseUrl).href;
          }
        } catch (e) {}
      });
      
      // Fix all iframes
      doc.querySelectorAll('iframe[src]').forEach(iframe => {
        try {
          const src = iframe.getAttribute('src');
          if (src && !src.startsWith('http') && !src.startsWith('//')) {
            iframe.src = new URL(src, baseUrl).href;
          }
        } catch (e) {}
      });
      
      return doc.documentElement.outerHTML;
    }

    function openInNewTab() {
      const url = document.getElementById('urlInput').value.trim();
      if (!url) {
        showError('Please enter a URL first');
        return;
      }

      let validUrl;
      try {
        validUrl = new URL(url);
      } catch (e) {
        try {
          validUrl = new URL('https://' + url);
        } catch (e2) {
          showError('Invalid URL');
          return;
        }
      }

      window.open(validUrl.href, '_blank');
    }

    function showError(message) {
      const errorDiv = document.getElementById('errorMessage');
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
    }

    function hideError() {
      document.getElementById('errorMessage').style.display = 'none';
    }

    // Allow Enter key to load
    document.getElementById('urlInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        loadEmbed();
      }
    });
  </script>
</body>
</html>

